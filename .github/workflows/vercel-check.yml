name: Vercel Deployment Check

on:
  push:
    branches: [ main ]
    paths:
      - 'vercel.json'
      - 'frontend/**'
      - 'backend/**'
  pull_request:
    paths:
      - 'vercel.json'
      - 'frontend/**'
      - 'backend/**'

jobs:
  vercel-check:
    name: ‚úÖ Vercel Configuration Check
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
      
      - name: üîç Validate vercel.json
        run: |
          echo "Validating vercel.json..."
          if [ ! -f vercel.json ]; then
            echo "‚ùå vercel.json missing"
            exit 1
          fi
          
          # Validate JSON syntax
          python3 -c "import json; json.load(open('vercel.json'))" && echo "‚úÖ Valid JSON syntax"
          
          # Check required fields
          python3 << 'EOF'
          import json
          with open('vercel.json') as f:
              config = json.load(f)
          
          print("Checking vercel.json configuration...")
          
          # Check version
          if config.get('version') != 2:
              print("‚ö†Ô∏è Warning: version should be 2")
          else:
              print("‚úÖ Version: 2")
          
          # Check builds
          if 'builds' in config:
              print(f"‚úÖ Builds configured: {len(config['builds'])} builder(s)")
              for build in config['builds']:
                  print(f"   - {build.get('src')} ‚Üí {build.get('use')}")
          else:
              print("‚ö†Ô∏è No builds configured")
          
          # Check rewrites
          if 'rewrites' in config:
              print(f"‚úÖ Rewrites configured: {len(config['rewrites'])} rule(s)")
          else:
              print("‚ö†Ô∏è No rewrites configured")
          
          # Check headers
          if 'headers' in config:
              print(f"‚úÖ Security headers configured: {len(config['headers'])} rule(s)")
          
          print("\nüéâ Vercel configuration check passed!")
          EOF
      
      - name: üìã Generate Summary
        run: |
          echo "## ‚úÖ Vercel Configuration Valid" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Component | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| vercel.json | ‚úÖ Valid |" >> $GITHUB_STEP_SUMMARY
          echo "| Frontend Build | Configured |" >> $GITHUB_STEP_SUMMARY
          echo "| Backend Build | Configured |" >> $GITHUB_STEP_SUMMARY
          echo "| Security Headers | Enabled |" >> $GITHUB_STEP_SUMMARY
